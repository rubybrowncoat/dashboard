<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deobfuscation Progress Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .overall-progress {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .overall-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .header-controls {
            margin-top: 20px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .snapshot-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .snapshot-selector label {
            font-weight: 600;
            color: #764ba2;
        }

        .snapshot-selector select {
            padding: 8px 12px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 6px;
            background: #f7f9ff;
            color: #333;
            font-size: 0.95em;
            cursor: pointer;
        }

        .snapshot-selector select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
        }

        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .category-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .category-percent {
            font-size: 2em;
            font-weight: bold;
            color: #764ba2;
            display: flex;
            align-items: baseline;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: wrap;
        }

        .progress-bar-container {
            background: #e0e0e0;
            border-radius: 10px;
            height: 30px;
            margin-bottom: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .category-stats {
            display: flex;
            justify-content: space-around;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }

        .category-stat {
            text-align: center;
        }

        .category-stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .category-stat-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .deobfuscated {
            color: #4caf50;
        }

        .obfuscated {
            color: #f44336;
        }

        .change-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.7em;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.25);
        }

        .change-positive {
            background: rgba(72, 187, 120, 0.2);
            color: #276749;
        }

        .change-negative {
            background: rgba(245, 101, 101, 0.2);
            color: #9b2c2c;
        }

        .change-neutral {
            background: rgba(160, 174, 192, 0.25);
            color: #4a5568;
        }

        .last-updated {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #f44336;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .stat-value {
                font-size: 2em;
            }

            .category-percent {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Deobfuscation Progress</h1>
            <p class="subtitle">Tracking the massive deobfuscation effort</p>
            <div class="header-controls">
                <div class="snapshot-selector">
                    <label for="snapshot-select">Snapshot</label>
                    <select id="snapshot-select" disabled>
                        <option>Loading...</option>
                    </select>
                </div>
            </div>
        </header>

        <div id="loading" class="loading">Loading deobfuscation data...</div>
        <div id="error" class="error" style="display: none;"></div>

        <div id="dashboard" style="display: none;">
            <div class="overall-progress">
                <h2 style="margin-bottom: 20px; color: #667eea;">Overall Progress</h2>
                <div class="overall-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="overall-percent">0%</div>
                        <div class="stat-label">Complete</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overall-total">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value deobfuscated" id="overall-deobfuscated">0</div>
                        <div class="stat-label">Deobfuscated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value obfuscated" id="overall-remaining">0</div>
                        <div class="stat-label">Remaining</div>
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="overall-progress-bar" style="width: 0%;">
                        <span id="overall-progress-text"></span>
                    </div>
                </div>
            </div>

            <div class="categories" id="categories-container">
                <!-- Category cards will be inserted here -->
            </div>

            <div class="last-updated" id="last-updated">
                Last updated: Never
            </div>
        </div>
    </div>

    <script>
        let snapshots = [];
        let currentSnapshotIndex = 0;

        async function loadData() {
            try {
                const response = await fetch('deobfuscation-progress.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                initializeDashboard(data);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = `Error loading data: ${error.message}. Make sure to run the analysis script first to generate deobfuscation-progress.json`;
                errorDiv.style.display = 'block';
            }
        }

        function initializeDashboard(data) {
            snapshots = buildSnapshots(data);
            if (!snapshots.length) {
                throw new Error('No snapshot data available.');
            }

            snapshots.sort((a, b) => {
                if (a.timestamp < b.timestamp) return -1;
                if (a.timestamp > b.timestamp) return 1;
                return 0;
            });
            currentSnapshotIndex = snapshots.length - 1;

            const loading = document.getElementById('loading');
            const dashboard = document.getElementById('dashboard');
            loading.style.display = 'none';
            dashboard.style.display = 'block';

            const select = document.getElementById('snapshot-select');
            select.innerHTML = '';
            snapshots.forEach((snapshot, index) => {
                const option = document.createElement('option');
                const timestamp = new Date(snapshot.timestamp);
                option.value = index.toString();
                option.textContent = `${timestamp.toLocaleString()} (${snapshot.overall.percentComplete}%)`;
                select.appendChild(option);
            });
            select.value = currentSnapshotIndex.toString();
            select.disabled = snapshots.length <= 1;
            select.onchange = (event) => {
                const nextIndex = parseInt(event.target.value, 10);
                if (!Number.isNaN(nextIndex)) {
                    currentSnapshotIndex = nextIndex;
                    renderDashboard(currentSnapshotIndex);
                }
            };

            renderDashboard(currentSnapshotIndex);
        }

        function buildSnapshots(data) {
            if (Array.isArray(data.history) && data.history.length) {
                return data.history
                    .filter((entry) => entry && entry.timestamp && entry.categories && entry.overall)
                    .map((entry) => ({
                        timestamp: entry.timestamp,
                        categories: entry.categories,
                        overall: entry.overall
                    }));
            }

            if (data && data.timestamp && data.categories && data.overall) {
                return [{
                    timestamp: data.timestamp,
                    categories: data.categories,
                    overall: data.overall
                }];
            }

            return [];
        }

        function renderDashboard(index) {
            const snapshot = snapshots[index];
            const previousSnapshot = index > 0 ? snapshots[index - 1] : null;

            const select = document.getElementById('snapshot-select');
            select.value = index.toString();

            updateOverallSection(snapshot, previousSnapshot);
            renderCategories(snapshot, previousSnapshot);
            updateLastUpdated(snapshot.timestamp);
        }

        function updateOverallSection(snapshot, previousSnapshot) {
            updateStatValue('overall-percent', snapshot.overall.percentComplete, previousSnapshot?.overall.percentComplete, { isPercent: true });
            updateStatValue('overall-total', snapshot.overall.total, previousSnapshot?.overall.total, { includeChangeBadge: false });
            updateStatValue('overall-deobfuscated', snapshot.overall.deobfuscated, previousSnapshot?.overall.deobfuscated);
            updateStatValue('overall-remaining', snapshot.overall.obfuscated, previousSnapshot?.overall.obfuscated);

            const overallBar = document.getElementById('overall-progress-bar');
            const overallBarText = document.getElementById('overall-progress-text');
            animateProgressBar(overallBar, snapshot.overall.percentComplete, overallBarText);
        }

        function renderCategories(snapshot, previousSnapshot) {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';

            const categoryOrder = ['classes', 'methods', 'methodArguments', 'methodVariables', 'fields', 'enums', 'enumValues'];
            const categoryLabels = {
                classes: 'Classes',
                methods: 'Methods',
                methodArguments: 'Arguments',
                methodVariables: 'Variables',
                fields: 'Fields',
                enums: 'Enums',
                enumValues: 'Enum Values'
            };

            categoryOrder.forEach((key) => {
                const category = snapshot.categories[key];
                if (!category) {
                    return;
                }

                const previousCategory = previousSnapshot?.categories?.[key];

                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `
                    <div class="category-header">
                        <div class="category-name">${categoryLabels[key]}</div>
                        <div class="category-percent">
                            ${category.percentComplete}%${renderChangeBadge(category.percentComplete, previousCategory?.percentComplete, { isPercent: true })}
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar category-progress-bar" data-target="${category.percentComplete}">
                            <span></span>
                        </div>
                    </div>
                    <div class="category-stats">
                        <div class="category-stat">
                            <div class="category-stat-value">
                                ${category.total.toLocaleString()}
                            </div>
                            <div class="category-stat-label">Total</div>
                        </div>
                        <div class="category-stat">
                            <div class="category-stat-value deobfuscated">
                                ${category.deobfuscated.toLocaleString()}${renderChangeBadge(category.deobfuscated, previousCategory?.deobfuscated)}
                            </div>
                            <div class="category-stat-label">Deobfuscated</div>
                        </div>
                        <div class="category-stat">
                            <div class="category-stat-value obfuscated">
                                ${category.obfuscated.toLocaleString()}${renderChangeBadge(category.obfuscated, previousCategory?.obfuscated)}
                            </div>
                            <div class="category-stat-label">Remaining</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });

            requestAnimationFrame(() => {
                container.querySelectorAll('.category-progress-bar').forEach((bar) => {
                    const target = Number(bar.getAttribute('data-target')) || 0;
                    animateProgressBar(bar, target);
                });
            });
        }

        function updateStatValue(elementId, value, previousValue, options = {}) {
            const element = document.getElementById(elementId);
            if (!element) {
                return;
            }
            const { isPercent = false, includeChangeBadge = true } = options;
            const formattedValue = isPercent ? `${value}%` : value.toLocaleString();
            const changeMarkup = includeChangeBadge ? renderChangeBadge(value, previousValue, { isPercent }) : '';
            element.innerHTML = `${formattedValue}${changeMarkup}`;
        }

        function renderChangeBadge(currentValue, previousValue, { isPercent = false } = {}) {
            if (previousValue === undefined || previousValue === null) {
                return '';
            }

            const delta = currentValue - previousValue;
            let className = 'change-neutral';
            if (delta > 0) {
                className = 'change-positive';
            } else if (delta < 0) {
                className = 'change-negative';
            }

            if (delta === 0) {
                return `<span class="change-badge ${className}">0${isPercent ? '%' : ''}</span>`;
            }

            const prefix = delta > 0 ? '+' : '';
            const valueText = isPercent ? `${delta}` : delta.toLocaleString();
            const suffix = isPercent ? '%' : '';
            return `<span class="change-badge ${className}">${prefix}${valueText}${suffix}</span>`;
        }

        function animateProgressBar(barElement, percent, textElement) {
            if (!barElement) {
                return;
            }

            const safePercent = Math.max(0, Math.min(100, Number(percent) || 0));

            barElement.style.transition = 'none';
            barElement.style.width = '0%';

            const span = textElement || barElement.querySelector('span');
            if (span) {
                span.textContent = '';
            }

            requestAnimationFrame(() => {
                barElement.style.transition = '';
                requestAnimationFrame(() => {
                    barElement.style.width = `${safePercent}%`;
                    if (span) {
                        span.textContent = `${safePercent}%`;
                    }
                });
            });
        }

        function updateLastUpdated(timestamp) {
            const lastUpdated = new Date(timestamp);
            document.getElementById('last-updated').textContent =
                `Last updated: ${lastUpdated.toLocaleString()}`;
        }

        loadData();
    </script>
</body>
</html>
